{"ast":null,"code":"import _toConsumableArray from\"/Users/ilan/dev/react-around-api-full/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/ilan/dev/react-around-api-full/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/ilan/dev/react-around-api-full/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/ilan/dev/react-around-api-full/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React from'react';import{Switch,Route,useHistory}from'react-router-dom';import Header from'./Header';import Main from'./Main';import Footer from'./Footer';import ImagePopup from'./ImagePopup';import api from'../utils/api';import CurrentUserContext from'../contexts/CurrentUserContext';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import ConfirmDelPopup from'./ConfirmDelPopup';import Register from'./Register';import Login from'./Login';import ProtectedRoute from'./ProtectedRoute';import InfoToolTip from'./InfoToolTip';import*as auth from'../utils/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddCardPopupOpen=_React$useState4[0],setIsAddCardPopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isCardImagePopupOpen=_React$useState8[0],setIsCardImagePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isConfirmDelPopupOpen=_React$useState10[0],setIsConfirmDelPopupOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isInfoToolTipOpen=_React$useState12[0],setIsInfoToolTipOpen=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),cardData=_React$useState14[0],setCardData=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),loading=_React$useState18[0],setLoading=_React$useState18[1];var _React$useState19=React.useState({}),_React$useState20=_slicedToArray(_React$useState19,2),cardDelConfirm=_React$useState20[0],setCardDelConfirm=_React$useState20[1];var _React$useState21=React.useState({}),_React$useState22=_slicedToArray(_React$useState21,2),currentUser=_React$useState22[0],setCurrentUser=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),isLoggedIn=_React$useState24[0],setIsLoggedIn=_React$useState24[1];var _React$useState25=React.useState({}),_React$useState26=_slicedToArray(_React$useState25,2),userData=_React$useState26[0],setUserData=_React$useState26[1];var _React$useState27=React.useState(false),_React$useState28=_slicedToArray(_React$useState27,2),registrationSuccess=_React$useState28[0],setRegistrationSuccess=_React$useState28[1];var _React$useState29=React.useState(false),_React$useState30=_slicedToArray(_React$useState29,2),isHamburgerMenuOpen=_React$useState30[0],setIsHamburgerMenuOpen=_React$useState30[1];var history=useHistory();React.useEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){auth.checkToken(jwt).then(function(res){if(res){var data={email:res.email,id:res._id};setIsLoggedIn(true);setUserData(data);}}).catch(function(err){console.log('WTH?',err);});}},[]);React.useEffect(function(){if(isLoggedIn){history.push('/');}},[isLoggedIn]);function handleRegistration(email,password){try{auth.signup(email,password).then(function(){setRegistrationSuccess(true);history.push('/');}).catch(function(err){setRegistrationSuccess(false);console.log('What',err);});}finally{setIsInfoToolTipOpen(true);}}function handleLogin(email,password){auth.signin(email,password).then(function(data){if(data){var _userData={email:email,token:data};setUserData(_userData);setIsLoggedIn(true);}}).catch(function(err){console.log(err);setRegistrationSuccess(false);setIsInfoToolTipOpen(true);});}function handleLogout(){localStorage.removeItem('jwt');setUserData({});setIsLoggedIn(false);history.push('/');}React.useEffect(function(){if(!isLoggedIn)return;api.getUserInfo().then(function(data){setCurrentUser(data);}).catch(function(err){console.log(err);});},[isLoggedIn]);React.useEffect(function(){if(!isLoggedIn)return;_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var cardsData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;_context.next=4;return api.getInitialCards();case 4:cardsData=_context.sent;if(cardsData){setCards(cardsData);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 11:_context.prev=11;setLoading(false);return _context.finish(11);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,8,11,14]]);}))();},[isLoggedIn]);function handleUserInfo(userData){try{api.editUserInfo(userData.name,userData.about).then(function(data){setUserData(data);closeAllPopups();});}catch(err){console.log(err);}}function handleCardLike(card){// Check one more time if this card was already liked\nvar isLiked=card.likes.some(function(i){return i===currentUser._id;});// Send a request to the API and getting the updated card data\nif(!isLiked){api.like(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}else if(isLiked){api.dislike(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}}function handleAddCard(cardData){api.uploadUserCard(cardData.name,cardData.link).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});}function handleCardDelete(e){e.preventDefault();api.deleteCard(cardDelConfirm._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==cardDelConfirm._id;});});closeAllPopups();}).catch(function(err){console.log(err);});}function handleUpdateAvatar(userData){try{api.setUserAvatar(userData.avatar).then(function(data){setUserData(data);closeAllPopups();});}catch(err){console.log(err);}}function handleEditProfilePopupClick(){setIsEditProfilePopupOpen(true);}function handleAddCardPopupClick(){setIsAddCardPopupOpen(true);}function handleEditAvatarPopupClick(){setIsEditAvatarPopupOpen(true);}function handleCardImagePopupClick(){setIsCardImagePopupOpen(true);}function handleConfirmDelPopupClick(card){setIsConfirmDelPopupOpen(true);setCardDelConfirm(card);}function handleHamburgerMenuClick(){if(!isHamburgerMenuOpen){setIsHamburgerMenuOpen(true);}else{setIsHamburgerMenuOpen(false);}}function handleCardData(cardData){setCardData(cardData);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddCardPopupOpen(false);setIsEditAvatarPopupOpen(false);setIsCardImagePopupOpen(false);setIsConfirmDelPopupOpen(false);setIsInfoToolTipOpen(false);setIsHamburgerMenuOpen(false);}React.useEffect(function(){var closeByEscape=function closeByEscape(e){if(e.key==='Escape'){closeAllPopups();}};document.addEventListener('keydown',closeByEscape);return function(){return document.removeEventListener('keydown',closeByEscape);};},[]);React.useEffect(function(){var closeByClick=function closeByClick(e){if(e.target.classList.contains('popup-menu')){closeAllPopups();}};document.addEventListener('click',closeByClick);return function(){return document.removeEventListener('click',closeByClick);};},[]);return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page-container\",children:[/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(Route,{path:\"/login\",children:[/*#__PURE__*/_jsx(Header,{type:\"login\"}),/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signup\",children:[/*#__PURE__*/_jsx(Header,{type:\"signup\"}),/*#__PURE__*/_jsx(Register,{handleRegistration:handleRegistration})]}),/*#__PURE__*/_jsxs(ProtectedRoute,{path:\"/\",isLoggedIn:isLoggedIn,children:[/*#__PURE__*/_jsx(Header,{email:userData.email,handleLogout:handleLogout,onHamburgerMenuClick:handleHamburgerMenuClick,isOpen:isHamburgerMenuOpen}),/*#__PURE__*/_jsx(Main,{onEditProfileClick:handleEditProfilePopupClick,onAddCardClick:handleAddCardPopupClick,onEditAvatarClick:handleEditAvatarPopupClick,onCardImageClick:handleCardImagePopupClick,updateCardData:handleCardData,cards:cards,onCardLike:handleCardLike,onCardDelete:handleConfirmDelPopupClick,loading:loading}),/*#__PURE__*/_jsx(Footer,{})]})]}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:isInfoToolTipOpen,onClose:closeAllPopups,registrationSuccess:registrationSuccess}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUserInfo:handleUserInfo}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddCardPopupOpen,onClose:closeAllPopups,onAddCard:handleAddCard}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(ImagePopup,{isOpen:isCardImagePopupOpen,onClose:closeAllPopups,cardData:cardData}),/*#__PURE__*/_jsx(ConfirmDelPopup,{isOpen:isConfirmDelPopupOpen,onClose:closeAllPopups,onSubmit:handleCardDelete})]})});}export default App;","map":{"version":3,"sources":["/Users/ilan/dev/react-around-api-full/frontend/src/components/App.js"],"names":["React","Switch","Route","useHistory","Header","Main","Footer","ImagePopup","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","ConfirmDelPopup","Register","Login","ProtectedRoute","InfoToolTip","auth","App","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddCardPopupOpen","setIsAddCardPopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isCardImagePopupOpen","setIsCardImagePopupOpen","isConfirmDelPopupOpen","setIsConfirmDelPopupOpen","isInfoToolTipOpen","setIsInfoToolTipOpen","cardData","setCardData","cards","setCards","loading","setLoading","cardDelConfirm","setCardDelConfirm","currentUser","setCurrentUser","isLoggedIn","setIsLoggedIn","userData","setUserData","registrationSuccess","setRegistrationSuccess","isHamburgerMenuOpen","setIsHamburgerMenuOpen","history","useEffect","jwt","localStorage","getItem","checkToken","then","res","data","email","id","_id","catch","err","console","log","push","handleRegistration","password","signup","handleLogin","signin","token","handleLogout","removeItem","getUserInfo","getInitialCards","cardsData","handleUserInfo","editUserInfo","name","about","closeAllPopups","handleCardLike","card","isLiked","likes","some","i","like","newCard","state","map","c","dislike","handleAddCard","uploadUserCard","link","handleCardDelete","e","preventDefault","deleteCard","filter","handleUpdateAvatar","setUserAvatar","avatar","handleEditProfilePopupClick","handleAddCardPopupClick","handleEditAvatarPopupClick","handleCardImagePopupClick","handleConfirmDelPopupClick","handleHamburgerMenuClick","handleCardData","closeByEscape","key","document","addEventListener","removeEventListener","closeByClick","target","classList","contains"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Switch, Route, useHistory } from 'react-router-dom';\nimport Header from './Header';\nimport Main from './Main';\nimport Footer from './Footer';\nimport ImagePopup from './ImagePopup';\nimport api from '../utils/api';\nimport CurrentUserContext from '../contexts/CurrentUserContext';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport ConfirmDelPopup from './ConfirmDelPopup';\nimport Register from './Register';\nimport Login from './Login';\nimport ProtectedRoute from './ProtectedRoute';\nimport InfoToolTip from './InfoToolTip';\nimport * as auth from '../utils/auth';\n\nfunction App() {\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\n    React.useState(false);\n  const [isAddCardPopupOpen, setIsAddCardPopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\n    React.useState(false);\n  const [isCardImagePopupOpen, setIsCardImagePopupOpen] = React.useState(false);\n  const [isConfirmDelPopupOpen, setIsConfirmDelPopupOpen] =\n    React.useState(false);\n  const [isInfoToolTipOpen, setIsInfoToolTipOpen] = React.useState(false);\n  const [cardData, setCardData] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [loading, setLoading] = React.useState(false);\n  const [cardDelConfirm, setCardDelConfirm] = React.useState({});\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [isLoggedIn, setIsLoggedIn] = React.useState(false);\n  const [userData, setUserData] = React.useState({});\n  const [registrationSuccess, setRegistrationSuccess] = React.useState(false);\n  const [isHamburgerMenuOpen, setIsHamburgerMenuOpen] = React.useState(false);\n\n  const history = useHistory();\n\n  React.useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      auth\n        .checkToken(jwt)\n        .then((res) => {\n          if (res) {\n            const data = {\n              email: res.email,\n              id: res._id,\n            };\n            setIsLoggedIn(true);\n            setUserData(data);\n          }\n        })\n        .catch((err) => {\n          console.log('WTH?', err);\n        });\n    }\n  }, []);\n\n  React.useEffect(() => {\n    if (isLoggedIn) {\n      history.push('/');\n    }\n  }, [isLoggedIn]);\n\n  function handleRegistration(email, password) {\n    try {\n      auth\n        .signup(email, password)\n        .then(() => {\n          setRegistrationSuccess(true);\n          history.push('/');\n        })\n        .catch((err) => {\n          setRegistrationSuccess(false);\n          console.log('What', err);\n        });\n    } finally {\n      setIsInfoToolTipOpen(true);\n    }\n  }\n\n  function handleLogin(email, password) {\n    auth\n      .signin(email, password)\n      .then((data) => {\n        if (data) {\n          const userData = {\n            email: email,\n            token: data,\n          };\n          setUserData(userData);\n          setIsLoggedIn(true);\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n        setRegistrationSuccess(false);\n        setIsInfoToolTipOpen(true);\n      });\n  }\n\n  function handleLogout() {\n    localStorage.removeItem('jwt');\n    setUserData({});\n    setIsLoggedIn(false);\n    history.push('/');\n  }\n\n  React.useEffect(() => {\n    if (!isLoggedIn) return;\n    api\n      .getUserInfo()\n      .then((data) => {\n        setCurrentUser(data);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, [isLoggedIn]);\n\n  React.useEffect(() => {\n    if (!isLoggedIn) return;\n    (async function () {\n      setLoading(true);\n      try {\n        const cardsData = await api.getInitialCards();\n        if (cardsData) {\n          setCards(cardsData);\n        }\n      } catch (err) {\n        console.log(err);\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, [isLoggedIn]);\n\n  function handleUserInfo(userData) {\n    try {\n      api.editUserInfo(userData.name, userData.about).then((data) => {\n        setUserData(data);\n        closeAllPopups();\n      });\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  function handleCardLike(card) {\n    // Check one more time if this card was already liked\n    const isLiked = card.likes.some((i) => i === currentUser._id);\n    // Send a request to the API and getting the updated card data\n    if (!isLiked) {\n      api\n        .like(card._id)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    } else if (isLiked) {\n      api\n        .dislike(card._id)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }\n\n  function handleAddCard(cardData) {\n    api\n      .uploadUserCard(cardData.name, cardData.link)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleCardDelete(e) {\n    e.preventDefault();\n    api\n      .deleteCard(cardDelConfirm._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id !== cardDelConfirm._id));\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  function handleUpdateAvatar(userData) {\n    try {\n      api.setUserAvatar(userData.avatar).then((data) => {\n        setUserData(data);\n        closeAllPopups();\n      });\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  function handleEditProfilePopupClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddCardPopupClick() {\n    setIsAddCardPopupOpen(true);\n  }\n\n  function handleEditAvatarPopupClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleCardImagePopupClick() {\n    setIsCardImagePopupOpen(true);\n  }\n\n  function handleConfirmDelPopupClick(card) {\n    setIsConfirmDelPopupOpen(true);\n    setCardDelConfirm(card);\n  }\n\n  function handleHamburgerMenuClick() {\n    if (!isHamburgerMenuOpen) {\n      setIsHamburgerMenuOpen(true);\n    } else {\n      setIsHamburgerMenuOpen(false);\n    }\n  }\n\n  function handleCardData(cardData) {\n    setCardData(cardData);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsAddCardPopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsCardImagePopupOpen(false);\n    setIsConfirmDelPopupOpen(false);\n    setIsInfoToolTipOpen(false);\n    setIsHamburgerMenuOpen(false);\n  }\n\n  React.useEffect(() => {\n    const closeByEscape = (e) => {\n      if (e.key === 'Escape') {\n        closeAllPopups();\n      }\n    };\n\n    document.addEventListener('keydown', closeByEscape);\n\n    return () => document.removeEventListener('keydown', closeByEscape);\n  }, []);\n\n  React.useEffect(() => {\n    const closeByClick = (e) => {\n      if (e.target.classList.contains('popup-menu')) {\n        closeAllPopups();\n      }\n    };\n\n    document.addEventListener('click', closeByClick);\n\n    return () => document.removeEventListener('click', closeByClick);\n  }, []);\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page-container\">\n        <Switch>\n          <Route path=\"/login\">\n            <Header type=\"login\" />\n            <Login handleLogin={handleLogin} />\n          </Route>\n          <Route path=\"/signup\">\n            <Header type=\"signup\" />\n            <Register handleRegistration={handleRegistration} />\n          </Route>\n\n          <ProtectedRoute path=\"/\" isLoggedIn={isLoggedIn}>\n            <Header\n              email={userData.email}\n              handleLogout={handleLogout}\n              onHamburgerMenuClick={handleHamburgerMenuClick}\n              isOpen={isHamburgerMenuOpen}\n            />\n            <Main\n              onEditProfileClick={handleEditProfilePopupClick}\n              onAddCardClick={handleAddCardPopupClick}\n              onEditAvatarClick={handleEditAvatarPopupClick}\n              onCardImageClick={handleCardImagePopupClick}\n              updateCardData={handleCardData}\n              cards={cards}\n              onCardLike={handleCardLike}\n              onCardDelete={handleConfirmDelPopupClick}\n              loading={loading}\n            />\n\n            <Footer />\n          </ProtectedRoute>\n        </Switch>\n        <InfoToolTip\n          isOpen={isInfoToolTipOpen}\n          onClose={closeAllPopups}\n          registrationSuccess={registrationSuccess}\n        />\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUserInfo={handleUserInfo}\n        />\n\n        <AddPlacePopup\n          isOpen={isAddCardPopupOpen}\n          onClose={closeAllPopups}\n          onAddCard={handleAddCard}\n        />\n\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n\n        <ImagePopup\n          isOpen={isCardImagePopupOpen}\n          onClose={closeAllPopups}\n          cardData={cardData}\n        />\n\n        <ConfirmDelPopup\n          isOpen={isConfirmDelPopupOpen}\n          onClose={closeAllPopups}\n          onSubmit={handleCardDelete}\n        />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}